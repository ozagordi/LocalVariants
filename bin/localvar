#!/usr/bin/env python3.4
'''executable for LocalVariants. No code here, only calling the relevant
methods.
'''


import os
import sys
import argparse


if __name__ == "__main__" and __package__ is None:

    # default action is 'store'
    parser = argparse.ArgumentParser(description='Local structure',
                                     epilog='Input are mandatory')
    parser.add_argument('-s', '--support', dest='support',
                        help='support file')
    parser.add_argument('-r', '--region', dest='region', default=None,
                        help='region in chr:start-stop format')
    parser.add_argument('-f', '--reference', dest='reference',
                        help='fasta file with the reference used in \
                        running shorah')
    args = parser.parse_args()

    # manipulate path to import functions
    parent_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
    os.sys.path.insert(1, parent_dir)
    mod = __import__('localvariants')
    sys.modules["localvariants"] = mod

    import logging

    import logging.handlers
    logging.basicConfig(filename='locstr.log', level=logging.DEBUG,
                        format='%(levelname)s %(asctime)s %(funcName)s %(lineno)d %(message)s', datefmt='%Y/%m/%d %H:%M:%S')

    dn = os.path.dirname(__file__)

#    hl = logging.handlers.RotatingFileHandler(LOG_FILENAME, 'w',
#                                              maxBytes=200000, backupCount=5)
#    fo = logging.Formatter("%(levelname)s %(asctime)s %(funcName)s\
#                          %(lineno)d %(message)s")
#    hl.setFormatter(fo)
#    lslog.addHandler(hl)
    logging.info(' '.join(sys.argv))

    from localvariants import LStructure as LS

    sample_ls = LS.LocalStructure(support_file=args.support, ref=args.reference,
                                  region=args.region)

    sample_ls.alignedvariants(threshold=0.95)

    sample_ls.print_mutations(args.reference, out_format='csv',
                              out_file='mutations_DNA.csv')
